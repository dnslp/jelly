<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Jelly No Run</title>
  <style>
    body {
      font-family: monospace;
      background-color: #888;
      margin: 0;
      overflow: hidden;
    }
    #menu {
      text-align: center;
      padding: 20px;
      color: white;
    }
    #menu a {
      margin: 10px;
      font-size: 30px;
      cursor: pointer;
      text-decoration: none;
    }
    canvas {
      display: block;
      background: #222;
    }
    #scoreBoard {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 24px;
      color: white;
      font-family: sans-serif;
    }
  </style>
</head>
<body>
  <div id="menu">
    <h1>Jelly No Run</h1>
    <h2>Select Character:</h2>
    <a data-color="orange">marmalade</a>
    <a data-color="red">strawberry</a>
    <a data-color="purple">grape</a>
    <a data-color="blue">blue raspberry</a>
    <a data-color="yellow">lemon</a>
    <a data-color="green">lime</a>
  </div>
  <div id="scoreBoard" style="display: none;">Score: 0</div>
  <canvas id="gameCanvas"></canvas>

  <script>
    const menu = document.getElementById('menu');
    const scoreBoard = document.getElementById('scoreBoard');
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let selectedColor = 'orange';
    let score = 0;
    let gameState = 'menu'; // "menu", "playing", "won"

    // ground as one big platform
    const ground = { x:0, y:0, width:0, height:50 };
    let platforms = [];  // additional platforms

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      ground.y = canvas.height - ground.height;
      ground.width = canvas.width;
      // two fixed platforms above the ground
      platforms = [
        { x: canvas.width * 0.2, y: ground.y - 150, width: 150, height: 10 },
        { x: canvas.width * 0.6, y: ground.y - 250, width: 150, height: 10 }
      ];
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    const player = {
      x:100, y:100, width:50, height:50,
      vx:0, vy:0, speed:5,
      jumpStrength:25,
      onGround:false,
      color:selectedColor
    };

    const coin = {
      radius:15,
      x:Math.random()*(canvas.width-30)+15,
      y:Math.random()*(canvas.height-200)+50,
      vx:(Math.random()-0.5)*4,
      vy:(Math.random()-0.5)*4
    };

    function resetGame() {
      score = 0;
      scoreBoard.textContent = "Score: " + score;
      player.x = 100; player.y = 100;
      player.vx = 0; player.vy = 0; player.onGround = false;
      spawnCoin();
    }

    function spawnCoin() {
      coin.x = Math.random()*(canvas.width-coin.radius*2)+coin.radius;
      coin.y = Math.random()*(canvas.height-200)+50;
      coin.vx = (Math.random()-0.5)*4;
      coin.vy = (Math.random()-0.5)*4;
    }

    const keys = {};
    window.addEventListener('keydown', e => {
      keys[e.key] = true;
      if(gameState==="playing" && e.key===' ' && player.onGround) jump();
      if(e.key.toLowerCase()==='m' && gameState!=="menu") {
        gameState = "menu";
        menu.style.display = 'block';
        scoreBoard.style.display = 'none';
      }
    });
    window.addEventListener('keyup', e => { keys[e.key] = false; });

    const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    function playBeep(freq=440, dur=0.1) {
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain); gain.connect(audioCtx.destination);
      osc.frequency.value = freq; osc.type = "sine";
      osc.start();
      gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
      osc.stop(audioCtx.currentTime + dur);
    }

    function jump() {
      player.vy = -player.jumpStrength;
      player.onGround = false;
      playBeep(600,0.15);
    }

    function checkCoinCollision() {
      const dx = Math.abs(coin.x - (player.x + player.width/2));
      const dy = Math.abs(coin.y - (player.y + player.height/2));
      if(dx > player.width/2 + coin.radius || dy > player.height/2 + coin.radius) return false;
      if(dx <= player.width/2 || dy <= player.height/2) return true;
      const rx = dx - player.width/2, ry = dy - player.height/2;
      return rx*rx + ry*ry <= coin.radius*coin.radius;
    }

    function update() {
      if(gameState!=="playing") return;

      // reset onGround each frame
      player.onGround = false;

      // horizontal
      if(keys['ArrowLeft']||keys['a']) { player.vx = -player.speed; playBeep(300,0.05); }
      else if(keys['ArrowRight']||keys['d']) { player.vx = player.speed; playBeep(300,0.05); }
      else player.vx = 0;

      // gravity
      player.vy += 0.8;

      // move
      player.x += player.vx;
      player.y += player.vy;

      // ground collision
      if(player.y + player.height > ground.y) {
        player.y = ground.y - player.height;
        player.vy = 0;
        player.onGround = true;
      }

      // platform collisions
      for(const p of platforms) {
        if(player.vy >= 0 &&
           player.y + player.height > p.y &&
           player.y + player.height - player.vy <= p.y &&
           player.x + player.width > p.x &&
           player.x < p.x + p.width) {
          player.y = p.y - player.height;
          player.vy = 0;
          player.onGround = true;
        }
      }

      // boundaries
      if(player.x<0) player.x=0;
      if(player.x+player.width>canvas.width) player.x = canvas.width-player.width;

      // move coin
      coin.x += coin.vx;
      coin.y += coin.vy;
      if(coin.x-coin.radius<0||coin.x+coin.radius>canvas.width) coin.vx*=-1;
      if(coin.y-coin.radius<0||coin.y+coin.radius>canvas.height) coin.vy*=-1;

      // collect
      if(checkCoinCollision()) {
        score += 5;
        scoreBoard.textContent = "Score: " + score;
        playBeep(800,0.1);
        spawnCoin();
      }

      // win
      if(score>=50) {
        gameState = "won";
        playBeep(1000,0.3);
      }
    }

    function drawGround() {
      ctx.fillStyle = "#555";
      ctx.fillRect(ground.x, ground.y, ground.width, ground.height);
    }

    function drawPlatforms() {
      ctx.fillStyle = "#444";
      for(const p of platforms) {
        ctx.fillRect(p.x, p.y, p.width, p.height);
      }
    }

    function drawPlayer() {
      ctx.save();
      ctx.translate(player.x + player.width/2, player.y + player.height/2);
      const wobble = Math.sin(Date.now()*0.005)*5;
      ctx.beginPath();
      ctx.ellipse(0,0, player.width/2, player.height/2 + wobble, 0, 0, Math.PI*2);
      ctx.fillStyle = player.color;
      ctx.fill();
      ctx.restore();
    }

    function drawCoin() {
      ctx.save();
      ctx.beginPath();
      ctx.arc(coin.x, coin.y, coin.radius, 0, Math.PI*2);
      ctx.fillStyle = "gold"; ctx.fill();
      ctx.lineWidth = 3; ctx.strokeStyle = "darkgoldenrod"; ctx.stroke();
      ctx.restore();
    }

    function drawWinScreen() {
      ctx.fillStyle = "rgba(0,0,0,0.7)";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = "white";
      ctx.font = "48px sans-serif"; ctx.textAlign = "center";
      ctx.fillText("You Win!", canvas.width/2, canvas.height/2 - 20);
      ctx.font = "24px sans-serif";
      ctx.fillText("Press M to return to menu", canvas.width/2, canvas.height/2 + 20);
    }

    function render() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      if(gameState==="playing"||gameState==="won") {
        drawGround();
        drawPlatforms();
        drawPlayer();
        drawCoin();
      }
      if(gameState==="won") drawWinScreen();
    }

    function gameLoop() {
      update();
      render();
      requestAnimationFrame(gameLoop);
    }

    // handle menu clicks
    document.querySelectorAll('#menu a').forEach(link=>{
      link.addEventListener('click',()=>{
        selectedColor = link.dataset.color;
        player.color = selectedColor;
        gameState = "playing";
        resetGame();
        menu.style.display = 'none';
        scoreBoard.style.display = 'block';
      });
    });

    // start the loop once
    gameLoop();
  </script>
</body>
</html>
